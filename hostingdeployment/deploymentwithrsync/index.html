<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Deployment with Rsync # https://gohugo.io/hosting-and-deployment/deployment-with-rsync/ If you have access to your web host with SSH, you can use a simple rsync one-liner to incrementally deploy your entire Hugo website. Assumptions # A web host running a web server. This could be a shared hosting environment or a VPS. Access to your web host with SSH A functional static website built with Hugo The spoiler is that you can deploy your"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://t.is-local.org/hugo/hostingdeployment/deploymentwithrsync/"><meta property="og:site_name" content="HUGO"><meta property="og:title" content="Deployment with Rsync"><meta property="og:description" content="Deployment with Rsync # https://gohugo.io/hosting-and-deployment/deployment-with-rsync/ If you have access to your web host with SSH, you can use a simple rsync one-liner to incrementally deploy your entire Hugo website. Assumptions # A web host running a web server. This could be a shared hosting environment or a VPS. Access to your web host with SSH A functional static website built with Hugo The spoiler is that you can deploy your"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="hostingdeployment"><meta property="article:published_time" content="2023-05-18T17:03:08+08:00"><meta property="article:modified_time" content="2023-05-18T17:03:08+08:00"><title>Deployment with Rsync | HUGO</title>
<link rel=manifest href=/hugo/manifest.json><link rel=icon href=/hugo/favicon.png><link rel=canonical href=https://t.is-local.org/hugo/hostingdeployment/deploymentwithrsync/><link rel=stylesheet href=/hugo/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css integrity="sha256-MJt+0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin=anonymous><script defer src=/hugo/fuse.min.js></script><script defer src=/hugo/zh-cn.search.min.a426f3a0e1e8951a39b1b352645e382bb08b14b3d53468b1f8b07b0d0928cfe6.js integrity="sha256-pCbzoOHolRo5sbNSZF44K7CLFLPVNGix+LB7DQkoz+Y=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/hugo/><span>HUGO</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder aria-label maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class="flex justify-between"><a role=button class="flex align-center"><img src=/hugo/svg/translate.svg class=book-icon alt=Languages>
中文</a></label><ul><li><a href=https://t.is-local.org/hugo/en/>English</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/hugo/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Deployment with Rsync</strong>
<label for=toc-control><img src=/hugo/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#assumptions>Assumptions</a></li><li><a href=#copy-your-ssh-key-to-your-host>Copy Your SSH Key to your Host</a></li><li><a href=#shell-script>Shell Script</a></li><li><a href=#另请参阅>另请参阅</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=deployment-with-rsync>Deployment with Rsync
<a class=anchor href=#deployment-with-rsync>#</a></h1><p><a href=https://gohugo.io/hosting-and-deployment/deployment-with-rsync/>https://gohugo.io/hosting-and-deployment/deployment-with-rsync/</a></p><p>If you have access to your web host with SSH, you can use a simple rsync one-liner to incrementally deploy your entire Hugo website.</p><h2 id=assumptions>Assumptions
<a class=anchor href=#assumptions>#</a></h2><ul><li>A web host running a web server. This could be a shared hosting environment or a VPS.</li><li>Access to your web host with SSH</li><li>A functional static website built with Hugo</li></ul><p>The spoiler is that you can deploy your entire website with a command that looks like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>hugo &amp;&amp; rsync -avz --delete public/ www-data@ftp.topologix.fr:~/www/
</span></span></code></pre></div><p>As you will see, we’ll put this command in a shell script file, which makes building and deployment as easy as executing <code>./deploy</code>.</p><h2 id=copy-your-ssh-key-to-your-host>Copy Your SSH Key to your Host
<a class=anchor href=#copy-your-ssh-key-to-your-host>#</a></h2><p>To make logging in to your server more secure and less interactive, you can upload your SSH key. If you have already installed your SSH key to your server, you can move on to the next section.</p><p>First, install the ssh client. On Debian distributions, use the following command:</p><p>install-openssh.sh</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo apt-get install openssh-client
</span></span></code></pre></div><p>Then generate your ssh key. First, create the <code>.ssh</code> directory in your home directory if it doesn’t exist:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>~$ cd &amp;&amp; mkdir .ssh &amp; cd .ssh
</span></span></code></pre></div><p>Next, execute this command to generate a new keypair called <code>rsa_id</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>~/.ssh/$ ssh-keygen -t rsa -q -C &#34;For SSH&#34; -f rsa_id
</span></span></code></pre></div><p>You’ll be prompted for a passphrase, which is an extra layer of protection. Enter the passphrase you’d like to use, and then enter it again when prompted, or leave it blank if you don’t want to have a passphrase. Not using a passphrase will let you transfer files non-interactively, as you won’t be prompted for a password when you log in, but it is slightly less secure.</p><p>To make logging in easier, add a definition for your web host to the file <code>~/.ssh/config</code> with the following command, replacing <code>HOST</code> with the IP address or hostname of your web host, and <code>USER</code> with the username you use to log in to your web host when transferring files:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>~/.ssh/$ cat &gt;&gt; config &lt;&lt;EOF
</span></span><span style=display:flex><span>Host HOST
</span></span><span style=display:flex><span>     Hostname HOST
</span></span><span style=display:flex><span>     Port 22
</span></span><span style=display:flex><span>     User USER
</span></span><span style=display:flex><span>     IdentityFile ~/.ssh/rsa_id
</span></span><span style=display:flex><span>EOF
</span></span></code></pre></div><p>Then copy your ssh public key to the remote server with the <code>ssh-copy-id</code> command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>~/.ssh/$ ssh-copy-id -i rsa_id.pub USER@HOST.com
</span></span></code></pre></div><p>Now you can easily connect to the remote server:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>~$ ssh user@host
</span></span><span style=display:flex><span>Enter passphrase for key &#39;/home/mylogin/.ssh/rsa_id&#39;:
</span></span></code></pre></div><p>Now that you can log in with your SSH key, let’s create a script to automate deployment of your Hugo site.</p><h2 id=shell-script>Shell Script
<a class=anchor href=#shell-script>#</a></h2><p>Create a new script called <code>deploy</code> the root of your Hugo tree:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>~/websites/topologix.fr$ editor deploy
</span></span></code></pre></div><p>Add the following content. Replace the <code>USER</code>, <code>HOST</code>, and <code>DIR</code> values with your own values:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/sh
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>USER<span style=color:#f92672>=</span>my-user
</span></span><span style=display:flex><span>HOST<span style=color:#f92672>=</span>my-server.com
</span></span><span style=display:flex><span>DIR<span style=color:#f92672>=</span>my/directory/to/topologix.fr/   <span style=color:#75715e># the directory where your web site files should go</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hugo <span style=color:#f92672>&amp;&amp;</span> rsync -avz --delete public/ <span style=color:#e6db74>${</span>USER<span style=color:#e6db74>}</span>@<span style=color:#e6db74>${</span>HOST<span style=color:#e6db74>}</span>:~/<span style=color:#e6db74>${</span>DIR<span style=color:#e6db74>}</span> <span style=color:#75715e># this will delete everything on the server that&#39;s not in the local public folder </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exit <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>Note that <code>DIR</code> is the relative path from the remote user’s home. If you have to specify a full path (for instance <code>/var/www/mysite/</code>) you must change <code>~/${DIR}</code> to <code>${DIR}</code> inside the command-line. For most cases you should not have to.</p><p>Save and close, and make the <code>deploy</code> file executable:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>~/websites/topologix.fr$ chmod +x deploy
</span></span></code></pre></div><p>Now you only have to enter the following command to deploy and update your website:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>~/websites/topologix.fr$ ./deploy
</span></span></code></pre></div><p>Your site builds and deploys:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>Started building sites ...
</span></span><span style=display:flex><span>Built site for language en:
</span></span><span style=display:flex><span>0 draft content
</span></span><span style=display:flex><span>0 future content
</span></span><span style=display:flex><span>0 expired content
</span></span><span style=display:flex><span>5 pages created
</span></span><span style=display:flex><span>0 non-page files copied
</span></span><span style=display:flex><span>0 paginator pages created
</span></span><span style=display:flex><span>0 tags created
</span></span><span style=display:flex><span>0 categories created
</span></span><span style=display:flex><span>total in 56 ms
</span></span><span style=display:flex><span>sending incremental file list
</span></span><span style=display:flex><span>404.html
</span></span><span style=display:flex><span>index.html
</span></span><span style=display:flex><span>index.xml
</span></span><span style=display:flex><span>sitemap.xml
</span></span><span style=display:flex><span>posts/
</span></span><span style=display:flex><span>posts/index.html
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sent 9,550 bytes  received 1,708 bytes  7,505.33 bytes/sec
</span></span><span style=display:flex><span>total size is 966,557  speedup is 85.86
</span></span></code></pre></div><p>You can incorporate other proprocessing tasks into this deployment script as well.</p><h2 id=另请参阅>另请参阅
<a class=anchor href=#%e5%8f%a6%e8%af%b7%e5%8f%82%e9%98%85>#</a></h2><ul><li><a href=https://gohugo.io/hosting-and-deployment/deployment-with-rclone/>Deployment with Rclone</a></li><li><a href=https://gohugo.io/hosting-and-deployment/hosting-on-azure/>Host on Azure Static Web Apps</a></li><li><a href=https://gohugo.io/hosting-and-deployment/hosting-on-gitlab/>Host on GitLab</a></li><li><a href=https://gohugo.io/hosting-and-deployment/hosting-on-keycdn/>Host on KeyCDN</a></li><li><a href=https://gohugo.io/hosting-and-deployment/hosting-on-netlify/>Host on Netlify</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#assumptions>Assumptions</a></li><li><a href=#copy-your-ssh-key-to-your-host>Copy Your SSH Key to your Host</a></li><li><a href=#shell-script>Shell Script</a></li><li><a href=#另请参阅>另请参阅</a></li></ul></nav></div></aside></main></body></html>