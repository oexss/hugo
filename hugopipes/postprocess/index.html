<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="PostProcess # https://gohugo.io/hugo-pipes/postprocess/ Allows delaying of resource transformations to after the build. 语法 # resources.PostProcess RESOURCE 用法 # Marking a resource with resources.PostProcess delays any transformations to after the build, typically because one or more of the steps in the transformation chain depends on the result of the build (e.g. files in public). A prime use case for this is CSS purging with PostCSS. There are currently two"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://t.is-local.org/hugo/hugopipes/postprocess/"><meta property="og:site_name" content="HUGO"><meta property="og:title" content="PostProcess"><meta property="og:description" content="PostProcess # https://gohugo.io/hugo-pipes/postprocess/ Allows delaying of resource transformations to after the build. 语法 # resources.PostProcess RESOURCE 用法 # Marking a resource with resources.PostProcess delays any transformations to after the build, typically because one or more of the steps in the transformation chain depends on the result of the build (e.g. files in public). A prime use case for this is CSS purging with PostCSS. There are currently two"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="hugopipes"><meta property="article:published_time" content="2023-05-18T17:03:08+08:00"><meta property="article:modified_time" content="2023-05-18T17:03:08+08:00"><title>PostProcess | HUGO</title>
<link rel=manifest href=/hugo/manifest.json><link rel=icon href=/hugo/favicon.png><link rel=canonical href=https://t.is-local.org/hugo/hugopipes/postprocess/><link rel=stylesheet href=/hugo/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css integrity="sha256-MJt+0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin=anonymous><script defer src=/hugo/fuse.min.js></script><script defer src=/hugo/zh-cn.search.min.a426f3a0e1e8951a39b1b352645e382bb08b14b3d53468b1f8b07b0d0928cfe6.js integrity="sha256-pCbzoOHolRo5sbNSZF44K7CLFLPVNGix+LB7DQkoz+Y=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/hugo/><span>HUGO</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder aria-label maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class="flex justify-between"><a role=button class="flex align-center"><img src=/hugo/svg/translate.svg class=book-icon alt=Languages>
中文</a></label><ul><li><a href=https://t.is-local.org/hugo/en/>English</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/hugo/svg/menu.svg class=book-icon alt=Menu>
</label><strong>PostProcess</strong>
<label for=toc-control><img src=/hugo/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#语法>语法</a></li><li><a href=#用法>用法</a></li><li><a href=#css-purging-with-postcss>CSS purging with PostCSS</a></li><li><a href=#hugo-environment-variables-available-in-postcss>Hugo Environment variables available in PostCSS</a></li><li><a href=#另请参阅>另请参阅</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=postprocess>PostProcess
<a class=anchor href=#postprocess>#</a></h1><p><a href=https://gohugo.io/hugo-pipes/postprocess/>https://gohugo.io/hugo-pipes/postprocess/</a></p><p>Allows delaying of resource transformations to after the build.</p><h2 id=语法>语法
<a class=anchor href=#%e8%af%ad%e6%b3%95>#</a></h2><pre tabindex=0><code>resources.PostProcess RESOURCE
</code></pre><h2 id=用法>用法
<a class=anchor href=#%e7%94%a8%e6%b3%95>#</a></h2><p>Marking a resource with <code>resources.PostProcess</code> delays any transformations to after the build, typically because one or more of the steps in the transformation chain depends on the result of the build (e.g. files in <code>public</code>).</p><p>A prime use case for this is <a href=https://gohugo.io/hugo-pipes/postprocess/#css-purging-with-postcss>CSS purging with PostCSS</a>.</p><p>There are currently two limitations to this:</p><ol><li><p>This only works in <code>*.html</code> templates (i.e. templates that produces HTML files).</p></li><li><p>You cannot manipulate the values returned from the resource’s methods. E.g. the <code>upper</code> in this example will not work as expected:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go-html-template data-lang=go-html-template><span style=display:flex><span><span style=color:#75715e>{{</span> <span style=color:#a6e22e>$css</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>resources</span><span style=color:#a6e22e>.Get</span> <span style=color:#e6db74>&#34;css/main.css&#34;</span> <span style=color:#75715e>}}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>{{</span> <span style=color:#a6e22e>$css</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$css</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>resources</span><span style=color:#a6e22e>.PostCSS</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>minify</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>fingerprint</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>resources</span><span style=color:#a6e22e>.PostProcess</span> <span style=color:#75715e>}}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>{{</span> <span style=color:#a6e22e>$css</span><span style=color:#a6e22e>.RelPermalink</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>upper</span> <span style=color:#75715e>}}</span>
</span></span></code></pre></div></li></ol><h2 id=css-purging-with-postcss>CSS purging with PostCSS
<a class=anchor href=#css-purging-with-postcss>#</a></h2><p>There are several ways to set up CSS purging with PostCSS in Hugo. If you have a simple project, you should consider going the simpler route and drop the use of <code>resources.PostProcess</code> and just extract keywords from the templates. See the <a href=https://tailwindcss.com/docs/controlling-file-size/#app>Tailwind documentation</a> for some examples.</p><p>The below configuration will write a <code>hugo_stats.json</code> file to the project root as part of the build. If you’re only using this for the production build, you should consider placing it below <a href=https://gohugo.io/getting-started/configuration/#configuration-directory>config/production</a>.</p><p>config.</p><p>=== &ldquo;yaml&rdquo;</p><pre><code>``` yaml
build:
  writeStats: true
```
</code></pre><p>=== &ldquo;toml&rdquo;</p><pre><code>``` toml
[build]
  writeStats = true
```
</code></pre><p>=== &ldquo;json&rdquo;</p><pre><code>``` json
{
   &quot;build&quot;: {
      &quot;writeStats&quot;: true
   }
}
```
</code></pre><p>postcss.config.js</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>purgecss</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;@fullhuman/postcss-purgecss&#39;</span>)({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> [ <span style=color:#e6db74>&#39;./hugo_stats.json&#39;</span> ],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>defaultExtractor</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>content</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>els</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>content</span>).<span style=color:#a6e22e>htmlElements</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>els</span>.<span style=color:#a6e22e>tags</span>.<span style=color:#a6e22e>concat</span>(<span style=color:#a6e22e>els</span>.<span style=color:#a6e22e>classes</span>, <span style=color:#a6e22e>els</span>.<span style=color:#a6e22e>ids</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>plugins</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>         ...(<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>HUGO_ENVIRONMENT</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;production&#39;</span> <span style=color:#f92672>?</span> [ <span style=color:#a6e22e>purgecss</span> ] <span style=color:#f92672>:</span> [])
</span></span><span style=display:flex><span>     ]
</span></span><span style=display:flex><span> };
</span></span></code></pre></div><p>Note that in the example above, the &ldquo;CSS purge step&rdquo; will only be applied to the production build. This means that you need to do something like this in your head template to build and include your CSS:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go-html-template data-lang=go-html-template><span style=display:flex><span><span style=color:#75715e>{{</span> <span style=color:#a6e22e>$css</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>resources</span><span style=color:#a6e22e>.Get</span> <span style=color:#e6db74>&#34;css/main.css&#34;</span> <span style=color:#75715e>}}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>{{</span> <span style=color:#a6e22e>$css</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$css</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>resources</span><span style=color:#a6e22e>.PostCSS</span> <span style=color:#75715e>}}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>{{</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>hugo</span><span style=color:#a6e22e>.IsProduction</span> <span style=color:#75715e>}}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>{{</span> <span style=color:#a6e22e>$css</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$css</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>minify</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>fingerprint</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>resources</span><span style=color:#a6e22e>.PostProcess</span> <span style=color:#75715e>}}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>{{</span> <span style=color:#66d9ef>end</span> <span style=color:#75715e>}}</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#75715e>{{</span> <span style=color:#a6e22e>$css</span><span style=color:#a6e22e>.RelPermalink</span> <span style=color:#75715e>}}</span><span style=color:#e6db74>&#34;</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> /&gt;
</span></span></code></pre></div><h2 id=hugo-environment-variables-available-in-postcss>Hugo Environment variables available in PostCSS
<a class=anchor href=#hugo-environment-variables-available-in-postcss>#</a></h2><p>These are the environment variables Hugo passes down to PostCSS (and Babel), which allows you do do <code>process.env.HUGO_ENVIRONMENT === 'production' ? [autoprefixer] : []</code> and similar:</p><ul><li><p>PWD</p><p>The absolute path to the project working directory. HUGO_ENVIRONMENT (and the alias HUGO_ENV)</p><p>The value e.g. set with <code>hugo -e production</code> (defaults to <code>production</code> for <code>hugo</code> and <code>development</code> for <code>hugo server</code>).</p></li><li><p>HUGO_PUBLISHDIR</p><p>{{ new-in &ldquo;0.109.0&rdquo; }} The absolute path to the publish directory (the <code>public</code> directory). Note that the value will always point to a directory on disk even when running <code>hugo server</code> in memory mode. If you write to this folder from PostCSS when running the server, you could run the server with one of these flags:</p></li></ul><pre tabindex=0><code>hugo server --renderToDisk
hugo server --renderStaticToDisk
</code></pre><p>Also, Hugo will add environment variables for all files mounted below <code>assets/_jsconfig</code>. A default mount will be set up with files in the project root matching this regexp: <code>(babel|postcss|tailwind)\.config\.js</code>.</p><p>These will get environment variables named on the form <code>HUGO_FILE_:filename:</code> where <code>:filename:</code> is all upper case with periods replaced with underscore. This allows you to do this and similar:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>tailwindConfig</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>HUGO_FILE_TAILWIND_CONFIG_JS</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;./tailwind.config.js&#39;</span>;
</span></span></code></pre></div><h2 id=另请参阅>另请参阅
<a class=anchor href=#%e5%8f%a6%e8%af%b7%e5%8f%82%e9%98%85>#</a></h2><ul><li><a href=https://gohugo.io/hugo-pipes/babel/>Babel</a></li><li><a href=https://gohugo.io/hugo-pipes/bundling/>Concat</a></li><li><a href=https://gohugo.io/hugo-pipes/resource-from-template/>ExecuteAsTemplate</a></li><li><a href=https://gohugo.io/hugo-pipes/fingerprint/>Fingerprint</a></li><li><a href=https://gohugo.io/hugo-pipes/resource-from-string/>FromString</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#语法>语法</a></li><li><a href=#用法>用法</a></li><li><a href=#css-purging-with-postcss>CSS purging with PostCSS</a></li><li><a href=#hugo-environment-variables-available-in-postcss>Hugo Environment variables available in PostCSS</a></li><li><a href=#另请参阅>另请参阅</a></li></ul></nav></div></aside></main></body></html>